scalar Date
scalar DateTime

directive @authed on FIELD_DEFINITION

type Member {
  _id: ID!
  number: Int!
  permission: Permission
  fullName: String
  givenNames: String
  surname: String
  mobile: String
  qualifications: [Qualification!]
  team: String
  availabilities(from: Date!, to: Date!): [Availability!]!
}

enum Permission {
  EDIT_SELF
  EDIT_TEAM
  EDIT_UNIT
}

enum Qualification {
  CHAINSAW_CROSSCUT
  FLOOD_RESCUE_1
  FLOOD_RESCUE_2
  FLOOD_RESCUE_3
  LAND_SEARCH
  STORM_WATER_DAMAGE
  VERTICAL_RESCUE
}

type Availability {
  _id: ID!
  member: Member!
  date: Date!
  shift: Shift!
  available: Boolean!
}

enum Shift {
  MORNING
  AFTERNOON
  NIGHT
}

type ShiftTeams {
  day: String!
  night: String!
}

type Query {
  """Gets all members with an optional team filter"""
  members(team: String): [Member!]! @authed

  """Gets a member by number"""
  member(number: Int!): Member @authed

  """Gets all members who indicated they're availabile at `instant`, or right now"""
  membersAvailable(instant: DateTime): [Member!]! @authed

  """Gets the current authorised member, or null if not logged in."""
  loggedInMember: Member

  """Gets all teams in the unit"""
  teams: [String!]! @authed

  """Gets the current shift teams"""
  shiftTeams: ShiftTeams @authed
}

type AuthPayload {
  token: String!
  member: Member!
}

input AvailabilityInput {
  date: Date!
  shift: Shift!
  available: Boolean!
}

type Mutation {
  """Logs in with a member number and password, and returns a token or an error"""
  login(memberNumber: Int!, password: String!): AuthPayload!

  """Saves availabilities for a member, checking the member has appropriate permissions"""
  setAvailabilities(memberNumber: Int!, availabilities: [AvailabilityInput]!): Boolean @authed
}
