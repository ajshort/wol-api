scalar Date
scalar DateTime

directive @authed on FIELD_DEFINITION

type Member {
  _id: ID!
  number: Int!
  permission: Permission
  fullName: String
  givenNames: String
  surname: String
  mobile: String
  qualifications: [String!]
  rank: String
  position: String
  team: String
  availabilities(from: Date!, to: Date!): [Availability!]!
}

enum Permission {
  EDIT_SELF
  EDIT_TEAM
  EDIT_UNIT
}

type Availability {
  _id: ID!
  member: Member!
  date: Date!
  shift: Shift!
  available: Boolean!
}

enum Shift {
  MORNING
  AFTERNOON
  NIGHT
}

enum TeamShift {
  DAY
  NIGHT
}

type ShiftTeams {
  day: String!
  night: String!
}

type DutyOfficer {
  shift: TeamShift!
  from: DateTime!
  to: DateTime!
  member: Member!
}

type Query {
  """Gets all members with an optional team filter"""
  members(team: String): [Member!]! @authed

  """Gets a member by number"""
  member(number: Int!): Member @authed

  """Gets all members who indicated they're availabile at `instant`, or right now"""
  membersAvailable(instant: DateTime): [Member!]! @authed

  """Gets the current authorised member, or null if not logged in."""
  loggedInMember: Member

  """Gets availabilities across a date range."""
  availabilities(from: Date!, to: Date!): [Availability!]! @authed

  """Gets all teams in the unit"""
  teams: [String!]! @authed

  """Gets the current shift teams"""
  shiftTeams: ShiftTeams @authed

  """Gets the scheduled duty officers for a date range"""
  dutyOfficers(from: DateTime, to: DateTime): [DutyOfficer]! @authed

  """Gets the duty officers at `instant`, defaulting to now"""
  dutyOfficersAt(instant: DateTime): [DutyOfficer]! @authed
}

type AuthPayload {
  token: String!
  member: Member!
}

input AvailabilityInput {
  date: Date!
  shift: Shift!
  available: Boolean!
}

type Mutation {
  """Logs in with a member number and password, and returns a token or an error"""
  login(memberNumber: Int!, password: String!): AuthPayload!

  """Saves availabilities for a member, checking the member has appropriate permissions"""
  setAvailabilities(memberNumber: Int!, availabilities: [AvailabilityInput]!): Boolean @authed

  """Sets the duty officer for a shift and date range"""
  setDutyOfficer(shift: TeamShift!, member: Int!, from: DateTime!, to: DateTime!): Boolean @authed
}
